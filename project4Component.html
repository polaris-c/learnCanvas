<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>P4-Component</title>
	<style type="text/css">
		body {
		    margin: 0;
		    overflow: hidden;
		 }
		canvas {
			margin: 10px;
			background-color: #999999;
		}
		.component {
			background-color: #EFEFEF;
		}
	</style>
</head>
<body>
	<div class="component">

		<div>
			<canvas></canvas>
		</div>

		<div>
			<button id="one">The One</button>
			<button id="two">The Two</button>
			<button id="three">The Three</button>
			<button id="four">The Four</button>
		</div>
	</div>

	<script type="text/javascript">
		let canvas = document.querySelector('canvas')
		let ctx = canvas.getContext('2d')
		let one = document.querySelector('#one')
		let two = document.querySelector('#two')
		let three = document.querySelector('#three')
		let four = document.querySelector('#four')

		let twoPointsFlag = false
		let clickCoordinates = []
		let clickFlag = 0
		let originXY = []
		let destinationXY = []
		let activeFunction = null

		let cursor = {
			x: 0,
			y: 0,
			radius: 1,
			color: 'rgb(0, 0, 200)',
			drawCursor: function() {
				ctx.beginPath()
				ctx.arc(this.x, this.y, this.radius, 0, Math.PI*2, true)
				ctx.closePath()
				ctx.fillStyle = this.color
				ctx.fill()
			}
		}
		let objectOne = {
			originXY: [],
			destinationXY: []
		}
		let objectTwo = {
			originXY: [],
			destinationXY: [],
			objectLength: null,
			calculate: function() {

			}
		}
		let objectThree = {
			originXY: [],
			destinationXY: [],
			objectAngle: null,
			calculate: function() {
				
			}
		}
		let objectFour = {
			coordinates: [],
			objectNum: null,
			calculate: function() {
				this.objectNum = this.coordinates.length
			}
		}

		canvas.addEventListener('mousemove', mouseMove)
		canvas.addEventListener('click', mouseClick)

		one.addEventListener('click', oneFunction)
		two.addEventListener('click', twoFunction)
		three.addEventListener('click', threeFunction)
		four.addEventListener('click', fourFunction)

		function clear() {
			ctx.fillStyle = 'rgba(200, 200, 200, 0.99)'
			ctx.fillRect(0, 0, canvas.width, canvas.height)
		}

		function clearVar() {
			twoPointsFlag = false
			clickCoordinates = []
			clickFlag = 0
			originXY = []
		  destinationXY = []
			activeFunction = null
		}

		function mouseMove(event) {
			clear()
			cursor.x = event.clientX - 10
			cursor.y = event.clientY - 10

			if (cursor.x >= canvas.width || cursor.x <= 0 ||
				cursor.y >= canvas.height || cursor.y <= 0) {
				console.log('Out Of Range')
				clearVar()
			}
			switch (activeFunction) {
				case 1:
				  handleOne()
					break
				case 2:
					handleTwo()
					break
				case 3:
					handleThree()
					break
				case 4:
					handleFour()
					break
				default:
					cursor.drawCursor()
			}
		}

		function mouseClick(event) {
			if (activeFunction) {
				clickFlag++
				console.log(clickFlag)
				if(activeFunction === 4) {
					console.log('clickCoordinates: ', clickCoordinates)
					clickCoordinates.push([event.clientX - 10, event.clientY - 10])
				} else {
					if (clickFlag % 2 === 1) {
						clear()
						originXY = [event.clientX - 10, event.clientY - 10]
						twoPointsFlag = true
					} else {
						destinationXY = [event.clientX - 10, event.clientY - 10]
						twoPointsFlag = false
					}
				}
			} else {
				console.log('Null Click')
			}
		}

		function switchFunction(functionFlag) {
			clearVar()
			if (activeFunction === functionFlag) {
				activeFunction = null
			} else {
				activeFunction = functionFlag
			}
			console.log('activeFunction: ', activeFunction)
		}

		function oneFunction(event) {
			console.log('ONE')
			switchFunction(1)
		}
		function handleOne() {
			if (twoPointsFlag) {
				ctx.strokeStyle = 'rgb(250, 50, 50)'
				ctx.strokeRect(originXY[0], originXY[1], cursor.x - originXY[0], cursor.y - originXY[1])
			} else if(originXY.length) {
				ctx.strokeStyle = 'rgb(250, 0, 0)'
				ctx.strokeRect(originXY[0], originXY[1], destinationXY[0] - originXY[0], destinationXY[1]- originXY[1])
				objectOne.originXY = originXY
				objectOne.destinationXY = destinationXY
				clearVar()
				console.log(objectOne)
			} else {
				cursor.drawCursor()
			}
		}

		function twoFunction(event) {
			console.log('TWO')
			switchFunction(2)
		}
		function handleTwo() {
			if (twoPointsFlag) {
				ctx.strokeStyle = 'rgb(50, 250, 50)'
				ctx.beginPath()
				ctx.moveTo(originXY[0], originXY[1])
				ctx.lineTo(cursor.x, cursor.y)
				ctx.stroke()
			} else if(originXY.length) {
				ctx.strokeStyle = 'rgb(0, 250, 0)'
				ctx.beginPath()
				ctx.moveTo(originXY[0], originXY[1])
				ctx.lineTo(destinationXY[0], destinationXY[1])
				ctx.stroke()
				objectTwo.originXY = originXY
				objectTwo.destinationXY = destinationXY
				clearVar()
				console.log(objectTwo)
			} else {
				cursor.drawCursor()
			}
		}

		function threeFunction(event) {
			console.log('THREE')
			switchFunction(3)
		}
		function handleThree() {
			if (twoPointsFlag) {
				ctx.strokeStyle = 'rgb(50, 50, 250)'
				ctx.beginPath()
				ctx.moveTo(originXY[0], originXY[1])
				ctx.lineTo(cursor.x, cursor.y)
				ctx.stroke()
			} else if(originXY.length) {
				ctx.strokeStyle = 'rgb(0, 0, 250)'
				ctx.beginPath()
				ctx.moveTo(originXY[0], originXY[1])
				ctx.lineTo(destinationXY[0], destinationXY[1])
				ctx.stroke()
				objectThree.originXY = originXY
				objectThree.destinationXY = destinationXY
				clearVar()
				console.log(objectThree)
			} else {
				cursor.drawCursor()
			}
		}

		function fourFunction(event) {
			console.log('FOUR')
			switchFunction(4)
		}
		function handleFour() {
			ctx.fillStyle = 'rgb(250, 250, 0)'
			for(i = 0; i < clickCoordinates.length; i++) {
				ctx.beginPath()
				ctx.arc(clickCoordinates[i][0], clickCoordinates[i][1], 2, 0, Math.PI*2, true)
				ctx.closePath()
				ctx.fill()
			}
			objectFour.coordinates = clickCoordinates
			objectFour.calculate()
			cursor.drawCursor()
		}
	</script>
</body>
</html>